name: Extension Build & Publish to Chrome

on:
    push:
        branches:
            - release

jobs:
    publish:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Set up Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "20"

            - name: Install dependencies
              run: npm ci

            - name: Build extension
              run: npm run build:chrome

            - name: Create zip for upload
              run: cd build && zip -r ../looi-extension.zip . && cd ..

            - name: Upload and publish Chrome extension
              run: node chrome_upload.js ${{ secrets.CHROME_EXTENSION_ID }} looi-extension.zip ${{ secrets.CHROME_PUBLISHER_ID }}
              env:
                  GCP_SERVICE_ACCOUNT_JSON: ${{ secrets.GCP_SERVICE_ACCOUNT_KEY }}
